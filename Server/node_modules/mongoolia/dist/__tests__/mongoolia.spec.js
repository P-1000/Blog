'use strict';

var _mongoose = require('mongoose');

var _mongoose2 = _interopRequireDefault(_mongoose);

var _index = require('../index');

var _index2 = _interopRequireDefault(_index);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('mongoolia', () => {
  const schema = new _mongoose2.default.Schema({
    indexedAttribute: { type: String, algoliaIndex: true },
    nonIndexedAttribute: { type: String }
  });

  it('should throw an error if options are missing', () => {
    // $FlowFixMe: We expect to throw, so flow error is expected as well
    expect(() => schema.plugin(_index2.default, {})).toThrowError(/Missing option/);
  });

  describe('extended model', () => {
    schema.plugin(_index2.default, {
      appId: 'foo',
      apiKey: 'foo',
      indexName: 'foo'
    });

    const Model = _mongoose2.default.model('Model', schema);

    it('should have additional static methods on model', () => {
      expect(Model.clearAlgoliaIndex).toBeDefined();
      expect(Model.syncWithAlgolia).toBeDefined();
      expect(Model.setAlgoliaIndexSettings).toBeDefined();
      expect(Model.algoliaSearch).toBeDefined();
    });

    it('should have additional instance methods on model', () => {
      const foo = new Model({});
      expect(foo.addObjectToAlgolia).toBeDefined();
      expect(foo.updateObjectToAlgolia).toBeDefined();
      expect(foo.deleteObjectFromAlgolia).toBeDefined();
    });

    it('should add `_algoliaObjectID` on the schema', () => {
      expect(Model.schema.paths).toHaveProperty('_algoliaObjectID');
    });
  });
});